{{ define "main" }}
<div class="row">
<div class="col-md-8">
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

          <header class="post-header">
            <h1 class="post-title" itemprop="name headline">{{ .Title }}</h1>
            <p class="post-meta"><time datetime='{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}' itemprop="datePublished">{{ .Date.Format "January 2, 2006" }}</time>{{ with .Params.Author }} â€¢ <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">{{ . }}</span></span>{{ end }}</p>
                 
          </header>

          <div class="post-content" itemprop="articleBody">
            <section>
              <h3>Prizes</h3>
              <div id="prizes">
                {{ partial "markdown2html" (dict "section" .Params.prizes "divId" "prizes") }}
              </div>
              <h3>Description</h3>
                <div id="description">
                  {{ partial "markdown2html" (dict "section" .Params.description "divId" "description") }}
                </div>
              <h3>Rules</h3>
                <div id="rules">
                  {{ partial "markdown2html" (dict "section" .Params.rules "divId" "rules") }}
                </div>
              <h3>Judging Criteria</h3>
                <div id="criteria">
                  {{ partial "markdown2html" (dict "section" .Params.criteria "divId" "criteria") }}
                </div>
              </div>
              <h3>Submission</h3>
                <div id="submission">
                  <a href="{{.Site.BaseURL}}/admin/#/collections/Draft-Legislation/new?competition={{.File.BaseFileName}}" target="_blank" class="button">Submit New Legislation</a>
                </div>
            </section>

            <section class="post-content">
              <h2>Legislation Submitted For This Competition</h2>
              <!-- Get the baseFileName, which is the slug from Netlify CMS, for comparison in the range below since it will not be available in that context-->
              {{ $competition := .File.BaseFileName }}
              <!-- Check that current page slug is equal to the competition parameter on the legislation -->
              {{ $legislation :=  (where .Site.RegularPages "Params.competition" $competition) }}
              <!-- if pages exist loop them, otherwise display "add new" link -->
              {{ if gt (len $legislation) 0 }}
                {{ range $legislation }}
                  <div class="index-content post">
                    <a href="{{.RelPermalink}}"><h4>{{.Title}}</h4></a>
                    {{ truncate 70 .Params.accomplishes }}<br>
                  </div>
                  <hr>
                {{ end }}
              {{ else }}
                <div class="index-content post">
                  No legislation has been submitted yet,
                  <a href="{{.Site.BaseURL}}/admin/#/collections/Draft-Legislation/new?competition={{.File.BaseFileName}}" target="_blank" class="button">Be The First To Submit New Legislation!</a>
                </div>
              {{ end }}
            </section>
          </div>

    </article>
    <div class="row">
        {{ if .Site.Params.disqus }}
         {{ partial "disqus.html" . }}
        {{ end }}
    </div>
    
    <div class="row">
            <ul class="pager">
             {{ with .Next }}
                    <li><a class="next" href="{{ .URL }}">&laquo; {{ .Title }}</a></li>
              {{ end }}
              {{ with .Prev }}
                <li><a class="previous" href="{{ .URL }}">{{ .Title }} &raquo;</a></li>
              {{ end }}
            </ul>
    </div>
</div>

</div>


{{ partial "fb-script.html" . }}
{{ end }}
